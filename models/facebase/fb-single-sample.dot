digraph isa_core_diagram {

    ratio=fill;
    node [shape=record style=rounded];
    edge [arrowhead=none arrowtail=crow dir=both];


    subgraph cluster_0 {

        label="study";

        personnel [label="{personnel|\
        id [PK]|\
	project_id [FK]|\
	full_name [text]|\
        affiliation [text]|\
        role [V]|\
        email [text]|\
	website [url]
        }"];

        project [label="{project|\
        id [PK: serial] |\
        name [text]|\
        abstract [text]|\
        funding [text]
        }"];

        study [label="{study|\
        id [PK: serial] |\
        accession [PK: text] |\
        project_id [FK]|\
        description [text]|\
        experiment_type [V]|\
	data_type [V]|\
        release_date [date]
        }"];

        publication [label="{publication|\
        id [PK: serial]|\
        project_id [FK]|\
        study_id [FK]|\
        pubmed_id [UNIQUE: text]|\
        doi [UNIQUE: text]|\
	url [text]|\
        title [text]|\
	abstract [text]|\
        status [V]
        }"];

        personnel -> project;
        study -> project;
        publication -> study;

    }

    subgraph cluster_sample {

        label="biosample";

        model [label="{model|\
        id [PK: serial]|\
        accession [PK: text]|\
        study_id [FK]|\
        species (V)|\
        strain (V)|\
        gender (V)|\
        genotype (V)|\
        mutation (V)|\
        gene (V)
        }"];

        biosample [label="{biosample|\
        id [PK serial]|\
        accession [PK: text]|\
        study_id [FK]|\
        stage (V)|\
        anatomy (V)|\
        specimen (V)|\
        gene (V)|\
        phenotype (V)|\
        litter (V)|\
        collection_date|\
        local_identifier|\
        clinical [FK] |\
        enhancer [FK]
        }"];

        clinical [label="{clinical|\
        id [PK: serial]|\
        age|\
        height|\
        weight|\
        head_circumference|\
        OMIM_diagnosis (V:OMIM)|\
        OMIM_code (V:OMIM)|\
        ICD10_diagnosis (V:ICD10)|\
        ICD10_code (V:ICD10)|\
        molecular_cytogenetic_diagnosis (V)|\
        diagnostic_evidence_notes
        }"]; 

        enhancer [label="{enhancer|\
        id [PK serial] |\
        original_species_assembly [text] |\
        original_species_chromosome [text] |\
        original_species_start [int] |\
        original_species_end [int] |\
        visualization_assembly [text] |\
        visualization_assembly_chromosome [text] |\
        visualization_assembly_start [int] |\
        visualization_assembly_end [int] |\
        other_assembly [text] |\
        other_assembly_chromosome [text] |\
        other_assembly_start [int] |\
        other_assembly_end [int] |\
        tested_sequence [text] |\
        tested_sequence_flag [text] |\
        list_of_closest_genes [V] |\
        external_database_name [text] |\
        external_id [text] |\
        list_of_anatomical_structures [V] |\
        lab_internal_reference [text]
        }"]

	model -> study;
	biosample -> model;
	biosample -> study;
        biosample -> clinical [arrowtail=none, arrowhead=teedot, dir=both, label=""]
        biosample ->  enhancer [arrowtail=none, arrowhead=teedot, dir=both, label=""]
    }


    subgraph cluster_2 {

        label="assays";

        image [label="{image|\
        id [PK:serial]|\
        accession [PK:text]|\
        study_id [FK]|\
        biosample_id [FK]|\
        file_id [FK]|\
        caption [text]|\
        intent (V)|\
        modality (V)|\
        equipment_model (V)|\
        dimensionality|\
        voxels [(x,y,z)]|\
        image_size [(x,y,z)]
        }"];

	bioassay [label="{bioassay|\
	id [PK:serial]|\
        accession [PK:text]|\
        study_id [FK]|\
	assay_profile_id [FK]|\
        biosample_id [FK]|\
	replicate_number [int]|\
	UNIQUE (biosample_id, replicate_number)
	}"];
    }

    image -> study;
    image -> biosample;
    bioassay -> study;
    bioassay -> biosample;
    bioassay -> assay_profile;

    subgraph cluster_5 {

        label="assay profile";

        assay_profile [label="{assay_profile|\
        id [PK serial] |\
        study_id [FK] |\
        biosample_id [FK] |\
        accession |\
        sample_composition |\
        sample_type |\
        molecule_type |\
        sample_purification |\
        markers |\
        isolation_protocol |\
        cell_count |\
        protocol |\
        pretreatment |\
        fragmentation_method |\
        reagent |\
        reagent_source |\
        reagent_catalog_number |\
        reagent_batch_number |\
        selection |\
        tracks_id [FK] |\
        library_id [FK] |\
        allignment_id [FK]
        }"]

        library [label="{library|\
        id [PK] |\
        library_type |\
        single_paired_end_sequencing |\
        library_adapters |\
        pcr_cycles |\
        library_yield |\
        size_selection |\
        platform
        }"]

        alignment [label="{alignment|\
        id [PK] |\
        aligner |\
        aligner_version |\
        aligner_flags |\
        reference_genome |\
        transcriptome_model |\
        sequence_trimming |\
        trimmed_seqs |\
        trimming_method |\
        duplicate_removal |\
        prealign_seq_removal
        }"]

        { rank=same; "library" "alignment" }
        assay_profile -> { "library" "alignment" } [arrowtail=none, arrowhead=teedot, dir=both, label=""]
    }

    assay_profile -> study;

    subgraph cluster_file {

        label="file";
       
        bioassay_file [label="{bioassay_file|\
        replicate_id [FK]|\
        file_id [FK] 
        }"];

        file [label="{file|\
        id [PK:serial]|\
        accession [UNIQUE:text]|\
        file_format [V:TBD]|\
        description [text]|\
        uri [UNIQUE:text]|\
        doi [UNIQUE:text]|\
        ark [UNIQUE:text]|\
        source_filename [text]|\
        size_in_bytes [int]|\
        checksum_type [V:TBD]|\
        checksum [text]|\
        creation_date [date]|\
        submission_date [date]
        }"];

    }
    bioassay_file -> file;
    bioassay_file -> bioassay;
    image -> file [arrowtail=none, arrowhead=teedot, dir=both, label=""];

    /* Begin Notes section
     */
    node [shape=note style=filled fillcolor=yellow];
    edge [arrowhead=none];

    //note [label="'[V:xyz]' is short-hand for a FK|to a concept table for 'xyz'.|Many columns in this model|depend on the 'OBI' vocabulary."];
}

