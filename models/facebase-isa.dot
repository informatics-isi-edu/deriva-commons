digraph isa_core_diagram {

    ratio=fill;
    node [shape=Mrecord];
    edge [arrowhead=crow arrowtail=none dir=both label=""];

    subgraph cluster_study {

        label="study";

        project [label="{project|\
        id [PK:serial] |\
        name [text]|\
        abstract [text]|\
        funding [text]
        }"];

        study [label="{study|\
        id [PK:serial] |\
        accession [PK:text] |\
        project_id [FK]|\
        description [text]|\
        experiment_type [V]|\
        study_design [text]|\
        release_date [date]
        }"];

        personnel [label="{personnel|\
        id [PK:serial]|\
	project_id [FK]|\
	full_name [text]|\
        affiliation [text]|\
        role [V]|\
        email [text]|\
	website [url]
        }"];

        publication [label="{publication|\
        id [PK:serial]|\
        project_id [FK]|\
        study_id [FK]|\
        pubmed_id [UNIQUE:text]|\
        doi [UNIQUE:text]|\
	url [text]|\
        title [text]|\
	abstract [text]|\
        status [V]
        }"];

        project -> {study personnel}
        study -> publication
        {rank=same; project study}
    }

    subgraph cluster_sample {

        label="sample";

        sample [label="{sample|\
        id [PK:serial]|\
        accession [PK:text]|\
        study_id [FK]|\
        replicate [int]|\
        species [V]|\
        strain [V]|\
        gender [V]|\
        genotype [V]|\
        mutation [V]|\
        gene [V]|\
        age_stage [V]|\
        anatomy [V]|\
        origin [V:TBD]|\
        specimen [V]|\
        phenotype [V]|\
        litter [V]|\
        collection_date|\
        local_identifier|\
        clinical_id [FK]|\
        enhancer_id [FK]
        }"];

        clinical [label="{clinical|\
        id [PK:serial]|\
        age|\
        height|\
        weight|\
        head_circumference|\
        OMIM_diagnosis (V:OMIM)|\
        OMIM_code (V:OMIM)|\
        ICD10_diagnosis (V:ICD10)|\
        ICD10_code (V:ICD10)|\
        molecular_cytogenetic_diagnosis [V]|\
        diagnostic_evidence_notes
        }"]; 

        enhancer [label="{enhancer|\
        id [PK serial] |\
        original_species_assembly [text] |\
        original_species_chromosome [text] |\
        original_species_start [int] |\
        original_species_end [int] |\
        visualization_assembly [text] |\
        visualization_assembly_chromosome [text] |\
        visualization_assembly_start [int] |\
        visualization_assembly_end [int] |\
        other_assembly [text] |\
        other_assembly_chromosome [text] |\
        other_assembly_start [int] |\
        other_assembly_end [int] |\
        tested_sequence [text] |\
        tested_sequence_flag [text] |\
        list_of_closest_genes [V] |\
        external_database_name [text] |\
        external_id [text] |\
        list_of_anatomical_structures [V] |\
        lab_internal_reference [text]
        }"]

        sample -> {clinical enhancer} [arrowtail=none arrowhead=teedot];
    }

    subgraph cluster_assays {

        label="assays";

        image [label="{image|\
        id [PK:serial]|\
        accession [PK:text]|\
        study_id [FK]|\
        sample_id [FK]|\
        thumbnail_uri [FK]|\
        file_id [FK]|\
        caption [text]|\
        intent [V]|\
        modality [V]|\
        equipment_model [V]|\
        dimensions [(x,y)]
        }"];

        volume [label="{volume|\
        id [PK:serial]|\
        accession [PK:text]|\
        study_id [FK]|\
        sample_id [FK]|\
        thumbnail_uri [FK]|\
        file_id [FK]|\
        caption [text]|\
        intent [V]|\
        modality [V]|\
        equipment_model [V]|\
        dimensions [(x,y,z)]
        }"];

	assay [label="{assay|\
	id [PK:serial]|\
        accession [PK:text]|\
        study_id [FK]|\
        sample_id [FK]|\
	replicate [int]|\
        molecule_type |\
        sample_composition |\
        sample_type |\
        sample_purification |\
        markers |\
        isolation_protocol |\
        cell_count |\
        protocol |\
        pretreatment |\
        fragmentation_method |\
        reagent |\
        reagent_source |\
        reagent_catalog_number |\
        reagent_batch_number |\
        selection
        }"]

        library [label="{library|\
        id [PK] |\
        assay_id [FK] |\
        library_type |\
        single_paired_end_sequencing |\
        library_adapters |\
        pcr_cycles |\
        library_yield |\
        size_selection |\
        platform
        }"]

        alignment [label="{alignment|\
        id [PK] |\
        assay_id [FK] |\
        aligner |\
        aligner_version |\
        aligner_flags |\
        reference_genome |\
        transcriptome_model |\
        sequence_trimming |\
        trimmed_seqs |\
        trimming_method |\
        duplicate_removal |\
        prealign_seq_removal
        }"]

        assay_file [label="{assay_file|\
        assay_id [FK]|\
        file_id [FK]
        }"];

        file [label="{file|\
        id [PK:serial]|\
        accession [UNIQUE:text]|\
        file_format [V]|\
        description [text]|\
        uri [PK:text]|\
        ark [UNIQUE:text]|\
        source_filename [text]|\
        size_in_bytes [int]|\
        checksum_type [V]|\
        checksum [text]|\
        creation_date [date]|\
        submission_date [date]
        }"];

        assay -> { library alignment assay_file };
        assay_file -> file [arrowhead=none arrowtail=crow];
        image -> file [arrowtail=none,arrowhead=teedot];
        volume -> file [arrowtail=none,arrowhead=teedot];
        { rank=same; assay image volume }
    }

    subgraph cluster_vocab {

        label="vocab";

        gene_summary [label="{gene_summary|\
        id [serial:PK]|\
        species_id [int:FK]|\
        gene_id [int:FK]|\
        anatomy_id [int:FK]|\
        age_id [int:FK]|\
        contributed_by [int:FK]|\
        summary [text]
        }"];

        gene [label="{gene|\
        chado columns...
        }"];

        gene -> gene_summary;
    }

    study -> {sample assay image volume};
    sample -> {assay image volume};
}

